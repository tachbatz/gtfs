{% extends 'he/base.html' %}

{% block content %}

<div dir="rtl"  class="form-content-wrapper">
  <div dir="rtl"  class="line_form__title"> חיפוש עבור קו אוטובוס</div>
          
          <p dir="rtl"  class="line_form__desc">
           על מנת להציג את הדוח עבור קו אוטובוס, יש לבחור עיר, מספר קו, כיוון נסיעה ותאריך.
          </p>

  </div> 

    <form class="line_form" id='line_form' data-lines-url="{% url 'ajax_load_lines' %}" data-directions-url="{% url 'ajax_load_directions' %}" action="../lines_report/" method="GET" >
      <input type="hidden" name="lang" value="he">  
      <!-- <div dir="rtl"  class="ui-widget"> -->
          <div dir="rtl"  class="line_form__item">
            <label for="city" class="line_form__label">עיר:</label>
            <select id="origin_city" name="origin_city" required>
              <option value="">----------</option>
              {% for city in cities %}
              <option value="{{ city }}">{{ city }}</option>
              {% endfor %}
              </select>
             <!-- 
            <span dir="rtl"  for="city" class="inputlabel"><input type="text" class="line_form__input " name="origin_city" id="combobox"  placeholder="Select the city" value="רמת השרון" required></span>
              -->
          </div>
        <!-- </div> -->
        
        <div dir="rtl"  class="line_form__item">
          <label for="line_number" class="line_form__label">מספר קו:</label>
          <select id="line_id" name="line_id" required>
            <option value="">----------</option>
          </select>
          <!--
          <span dir="rtl"  for="line_number" class="inputlabel"><input type="text" class="line_form__input line_form__input--small" name="line_number" id="line_number" min="1" max="5" placeholder="Enter the line number" value="{{current_line_number}}" required></span>                  
          -->
        </div>
        
        <div dir="rtl"  class="line_form__item">
          <label for="direction" class="line_form__label" required>כיוון:</label>
          <select id="directionC" name="direction" required>
            <option value="">----------</option>
          </select>         
        </div>
        
        <div dir="rtl"  class="line_form__item">
          <label for="date" class="line_form__label">תאריך:</label>
          <span dir="rtl"  for="date"><input type="date" class="date" id="start" name="report_date" style="direction: rtl;" value={{current_date}} min={{min_date}} max={{current_date}} required></span>
          <span dir="rtl"  style='color: red;'>{{error}}</span>
        </div>
        
        <input id="direction_flag" name="direction_flag" type="hidden" value=0>
        
        <div dir="rtl"  class="line_form__item">
          <button type="submit" id="btnFetch" class="line_form__btn btn btn-primary mb-2">שלח</button>
        </div>
      
    </form>

<!-----------------------------------------START ---------------------------------------------------------->
<!--
    <script>
      var citysource = "/line_form/?bycity=".concat(document.getElementById('origin_city').value);
       $( function() {
         $( "#origin_city" ).autocomplete({
           source: '{% url 'line_form' %}',
           minLength: 2
         });
       } );

       $( function() {
         $( "#line_number" ).autocomplete({
           //source: '{% url 'line_form' %}bycity'+document.getElementById('origin_city').value,
           source: citysource,
           minLength: 1
         });
         console.log( "#origin_city" );
       } );
    </script>
-->
    

<!-----------------------------------------END ---------------------------------------------------------->
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


<script>
    var stopCity = ""
    $("#origin_city").change(function () {
      const url = $("#line_form").attr('data-lines-url');  // get the url of the `load_lines` view
      var stopCity = $(this).val();  // get the selected origin city from the HTML input

      $.ajax({                       // initialize an AJAX request
          url: url,                    // set the url of the request (= ajax/load-cities/ )
          data: {
              'stop_city': stopCity       // add the origin city to the GET parameters
          },
          success: function (data) {   // `data` is the return of the `load_lines` view function
              console.log(data);
              $("#line_id").html(data);  // replace the contents of the line number input with the data that came from the server
          }
      });
    });
</script>
<script>
    $("#line_id").change(function () {
      const url = $("#line_form").attr('data-directions-url');
      const lineId = $(this).val();  // get the selected origin city from the HTML input
      console.log(lineId);
      const  stopCity = document.getElementById('origin_city').value;
      console.log(stopCity);
      $.ajax({                       // initialize an AJAX request
          url: url,  // set the url of the request (= ajax/load-directions/ )
          data: {
              'line_id': lineId,
              'stop_city': stopCity       // add the stop city to the GET parameters
          },
          success: function (data) {   // `data` is the return of the `load_directions` view function
              console.log(data);
              $("#directionC").html(data);  // replace the contents of the direction input with the data that came from the server
          }
      });
    });
  
  </script>
  
</div>

{% endblock %}





